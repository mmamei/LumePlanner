<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <title>LumePlanner</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/jquery.md5.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <link rel="stylesheet" href="css/font-awesome-4.7.0/css/font-awesome.min.css">
    <script src="js/LeafletPlayback.min.js"></script>
    <link rel="stylesheet" href="css/ionicons.min.css">
    <link rel="stylesheet" href="css/leaflet.awesome-markers.css">
    <script src="js/leaflet.awesome-markers.min.js"></script>
    <script src="js/global.js"></script>
    <style>

        body {
            background-color: #084265;
            color: #ffffff;
        }

        .title {
            background-color:#031b26;
            color:#82a4a6;
            padding:20px;
        }

        .img-responsive {
            margin: 0 auto;
        }

        #mapid {
            height: 480px;
            padding:10px;
        }


        .marker {
            margin-left: -17px !important;
            margin-top: -25px !important;
            width: 0px !important;
            height: 0px !important;
        }

        .fa-col-blue {
            color: #084265;
            opacity: 0.8;
        }
        .fa-col-green {
            color: #008a53;
            opacity: 0.8;
        }
        .fa-col-red {
            color: #ff9600;
            opacity: 0.8;
        }

    </style>

    <script>

        var mymap;




        var centerMarker = null;
        function localize(position) {
            console.log("localized at "+position.coords.latitude+","+position.coords.longitude);

            mymap.panTo([position.coords.latitude, position.coords.longitude]);
            if(centerMarker == null) {

                var icon = L.divIcon({
                        type: 'div',
                        className: 'marker',
                        html: "<span class=\"fa-col-blue\"><i class=\"fa fa-dot-circle-o fa-3x fa-rotate-dyn\"></i></span>"
                    });
                centerMarker = L.marker([position.coords.latitude, position.coords.longitude], {icon: icon}).addTo(mymap);
                mymap.setZoom(15)
            }



            centerMarker.setLatLng([position.coords.latitude, position.coords.longitude]);



            window.setTimeout(function(){navigator.geolocation.getCurrentPosition(localize)},1000)

        }




        $(document).ready(function(){



            var pois = JSON.parse(window.sessionStorage.getItem("pois"));

            console.log(pois);

            mymap = L.map('mapid',{
                attributionControl: false,
                scrollWheelZoom: true,
                doubleClickZoom: true,
                zoomControl: true,
                touchZoom: true,
                dragging: true,
            });


            var markers = [];
            var minLat = 1000;
            var minLon = 1000;
            var maxLat = -1000;
            var maxLon = -1000;

            for(var type in pois) {
                console.log(type);
                if(pois[type])
                for (var i = 0; i < pois[type].length; i++) {
                    var x = pois[type][i];
                    var lat = x.geometry.coordinates[1];
                    var lon = x.geometry.coordinates[0];
                    var marker = L.marker([lat, lon], {icon: markerIcons[type]}).addTo(mymap);
                    marker.bindPopup(format_name(x.display_name)).openPopup();
                    markers.push(marker);
                    minLat = Math.min(minLat, lat);
                    minLon = Math.min(minLon, lon);
                    maxLat = Math.max(maxLat, lat);
                    maxLon = Math.max(maxLon, lon)
                }
            }

            mymap.fitBounds([
                [minLat, minLon],
                [maxLat, maxLon]
            ]);

            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mymap);


            if(conf.localize && navigator.geolocation)
                navigator.geolocation.getCurrentPosition(localize);


            $("#itinerary").click(function(){
                window.location.href = "home.html";
            })

        })
    </script>

</head>
<body>

<div class="container-fluid">
    <div id="mapid"></div>
</div>

<div class="container-fluid text-center">
    <button id="itinerary" type="button" class="btn btn-primary btn-lg" style="margin-top:20px">Itinerary</button>
</div>

</body>
</html>